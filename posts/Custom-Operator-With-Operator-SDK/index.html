<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Custom Kubernetes Operators in Golang with OperatorSDK and Kubebuilder" /><meta name="author" content="Malike St Lewis" /><meta property="og:locale" content="en" /><meta name="description" content="Kubernetes Operators" /><meta property="og:description" content="Kubernetes Operators" /><link rel="canonical" href="/posts/Custom-Operator-With-Operator-SDK/" /><meta property="og:url" content="/posts/Custom-Operator-With-Operator-SDK/" /><meta property="og:site_name" content="Malike St" /><meta property="og:image" content="https://raw.githubusercontent.com/malike/malike-media/main/posts/operator-sdk/programming.gif" /><meta property="og:image:height" content="500" /><meta property="og:image:width" content="800" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-06T00:00:00+01:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://raw.githubusercontent.com/malike/malike-media/main/posts/operator-sdk/programming.gif" /><meta property="twitter:title" content="Custom Kubernetes Operators in Golang with OperatorSDK and Kubebuilder" /><meta name="twitter:site" content="@malike_st" /><meta name="twitter:creator" content="@malike_st" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Malike St Lewis","url":"https://github.com/malike/"},"dateModified":"2023-01-06T00:00:00+01:00","datePublished":"2023-01-06T00:00:00+01:00","description":"Kubernetes Operators","headline":"Custom Kubernetes Operators in Golang with OperatorSDK and Kubebuilder","image":{"width":800,"height":500,"url":"/posts/operator-sdk/programming.gif","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"/posts/Custom-Operator-With-Operator-SDK/"},"url":"/posts/Custom-Operator-With-Operator-SDK/"}</script><title>Custom Kubernetes Operators in Golang with OperatorSDK and Kubebuilder | Malike St</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Malike St"><meta name="application-name" content="Malike St"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.githubusercontent.com/malike/malike-media/main/common/avatar.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Malike St</a></div><div class="site-subtitle font-italic">Tech & stuff</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/sre/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>SRE</span> </a><li class="nav-item"> <a href="/distributed/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>DISTRIBUTED SYSTEMS</span> </a><li class="nav-item"> <a href="/electronics/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ELECTRONICS</span> </a><li class="nav-item"> <a href="/oss/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>OS PROJECTS I STARTED</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/malike" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://gitlab.com/malike" aria-label="gitlab" target="_blank" rel="noopener"> <i class="fab fa-gitlab"></i> </a> <a href="https://twitter.com/malike_st" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['st.malike','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Custom Kubernetes Operators in Golang with OperatorSDK and Kubebuilder</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Custom Kubernetes Operators in Golang with OperatorSDK and Kubebuilder</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1672959600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 6, 2023 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/malike/malike-media/main/posts/operator-sdk/programming.gif" class="preview-img bg" alt="Preview Image" width="800" height="500" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/malike/">Malike St Lewis</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1838 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><h1 id="kubernetes-operators">Kubernetes Operators</h1><p>Kubernetes Operators are patterns that help us extend the behavior of the cluster. Operators enable us to view an application deployed on Kubernetes as one item. That is your application can composed of a Pod, a Service, a ConfigMap a Deployement etc but you get to manage it as one item and have a much better control of their lifecycle. The lifecycle includes but not limited to installation and configuration and also manage failover and recovery relying on the APIs and Patterns provided by Kubernetes.</p><p>If you’re not new to Kubernetes you probably have used a couple of operators, like <a href="https://github.com/grafana-operator/grafana-operator">Grafana</a>, <a href="https://github.com/prometheus-operator/prometheus-operator">Prometheus</a>, and a couple of ones I blogged about in the past <a href="../Apache-Kafka-On-Kubernetes-Strimzi-Operator/">like Strimzi</a> for deployment and management of Kafka <a href="../Cassandra-DSE-On-Kubernetes-With-Cass-Operator/">Cass Operator</a> for doing the same with Cassandra or DSE.</p><p>Now that we know what operators are, how do we build one?.</p><p>There are a couple of ways to <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/operator/#writing-operator">build</a> an operator. However, we will be focusing on build a simple one with <a href="https://sdk.operatorframework.io/">Operator SDK</a>. This is part of the <a href="https://operatorframework.io/">Operator framework</a> that is set of developer tools and Kubernetes components, that aid in Operator development and central management on a multi-tenant cluster. There are three options for Operator development with Operator SDK, that is Golang, Ansible, or Helm. This post is focused on doing this in Go. To get started, we first need to <a href="https://sdk.operatorframework.io/docs/installation/">install the OperatorSDK</a>.</p><p><a href="https://book.kubebuilder.io/">Kubebuilder</a> is a framework for building Kubernetes Operators. Operator SDK uses Kubebuilder under the hood to do so for Go projects.</p><h1 id="putting-it-all-together">Putting it all together</h1><p>Putting it all together we can build a <a href="https://github.com/malike/mock-operator">Mock Operator</a>. It won’t do much but we will get to use the Operator SDK to build a custom Operator that basically launches a Kubernetes Deployment and helps us manage the lifecycle. This is available on Github as <a href="https://github.com/malike/mock-operator">https://github.com/malike/mock-operator</a>.</p><p>Before we start building we can define our Mock Operator specification.</p><h3 id="i-operator-specification"><span class="mr-2">i. Operator Specification</span><a href="#i-operator-specification" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">app.malike.kendeh.com/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">SampleKind</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mock-sample</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">image</span><span class="pi">:</span>
    <span class="na">repository</span><span class="pi">:</span> <span class="s">ghcr.io/malike/mock-operator/sample-mock-service</span>
    <span class="na">tag</span><span class="pi">:</span> <span class="s">latest</span>
    <span class="na">pullPolicy</span><span class="pi">:</span> <span class="s">Always</span>
    <span class="na">pullSecretName</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">regcred</span>
  <span class="na">nodes</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
  <span class="na">servicePort</span><span class="pi">:</span> <span class="m">80</span>
</pre></table></code></div></div><p>Things to note:</p><p>i. <code class="language-plaintext highlighter-rouge">apiVersion</code> of the Operator is <code class="language-plaintext highlighter-rouge">app.malike.kendeh.com/v1alpha1</code> <br /> ii. The Operator has one <code class="language-plaintext highlighter-rouge">kind</code> which is <code class="language-plaintext highlighter-rouge">SampleKind</code> <br /> iii. The Operator basically deploys a custom image which will passed as <code class="language-plaintext highlighter-rouge">image.repository</code> <br /> iv. Other parameters that describe the image are in the <code class="language-plaintext highlighter-rouge">image: {}</code> block. <br /> v. We use nodes to specify the number of instances we want to deploy. <br /> iv. Configure the port for services and the pod as <code class="language-plaintext highlighter-rouge">servicePort</code> and <code class="language-plaintext highlighter-rouge">containerPort</code> respectively.<br /></p><p>After defining the specification we can proceed to the next step of actually building</p><h3 id="ii-start-coding"><span class="mr-2">ii. Start coding</span><a href="#ii-start-coding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Once you have <a href="https://sdk.operatorframework.io/docs/installation/">Operator SDK installed</a>, we can generate project files for our Mock Operator. By running this command, we create an initial package.</p><pre><code class="language-commandline">    operator-sdk init --domain malike.kendeh.com --repo github.com/malike/mock-operator
</code></pre><p>After generating the project we can proceed and generate the api controller. We want our API controller to be called <code class="language-plaintext highlighter-rouge">SampleKind</code> with group as <code class="language-plaintext highlighter-rouge">app</code>.</p><pre><code class="language-commandline">    operator-sdk create api --group app --version v1alpha1 --kind SampleKind --resource --controller
</code></pre><p>iv. Building Operator</p><p>Before we start coding let us look at the structure of the source generated by operator-sdk using the two commands.</p><p><img data-src="https://raw.githubusercontent.com/malike/malike-media/main/posts/operator-sdk/intellij-tree.png" alt="deployed" data-proofer-ignore></p><p><a href="https://sdk.operatorframework.io/docs/overview/project-layout/#golang">This link</a> on Operator SDK helps us understand the project layout structure much better.</p><p>Our changes will be much focused on the <strong>api</strong> and the <strong>controllers</strong> folders.</p><p>Base on our specification we can update the API spec of the operator to meet what defined. Our API has for main parameters, that is <code class="language-plaintext highlighter-rouge">image: {}</code>, <code class="language-plaintext highlighter-rouge">node: 2</code>, <code class="language-plaintext highlighter-rouge">containerPort: 80</code>, <code class="language-plaintext highlighter-rouge">servicePort: 80</code>. We can update the specication to include these parametes</p><div class="language-golang highlighter-rouge"><div class="code-header"> <span data-label-text="Golang"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c">// SampleKindSpec defines the desired state of SampleKind</span>
<span class="k">type</span> <span class="n">SampleKindSpec</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="c">//+kubebuilder:validation:Type:=object</span>
	<span class="c">// Image defines image configuration</span>
	<span class="n">Image</span> <span class="n">ImageSpec</span> <span class="s">`json:"image,omitempty"`</span>
	<span class="c">//+kubebuilder:validation:Type:=number</span>
	<span class="c">//+kubebuilder:default:=2</span>
	<span class="c">// Nodes defines number of instance</span>
	<span class="n">Nodes</span> <span class="kt">int32</span> <span class="s">`json:"nodes,omitempty"`</span>
	<span class="c">//+kubebuilder:validation:Type:=number</span>
	<span class="c">//+kubebuilder:default:=80</span>
	<span class="c">// ContainerPort defines port for container</span>
	<span class="n">ContainerPort</span> <span class="kt">int32</span> <span class="s">`json:"containerPort,omitempty"`</span>
	<span class="c">//+kubebuilder:validation:Type:=number</span>
	<span class="c">//+kubebuilder:default:=80</span>
	<span class="c">// ServicePort defines port for service</span>
	<span class="n">ServicePort</span> <span class="kt">int32</span> <span class="s">`json:"servicePort,omitempty"`</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Using kubebuilder <a href="https://book.kubebuilder.io/reference/markers/crd-validation.html">CRD marker validation</a>, we can enforce rules for these parameters. For example <code class="language-plaintext highlighter-rouge">nodes</code> should always be an <code class="language-plaintext highlighter-rouge">int32</code>. Once defined we can run the command <code class="language-plaintext highlighter-rouge">make generate manifests</code> and then using the helper classes set up by Operator SDK the CRD and codes containing DeepCopy, DeepCopyInto, and DeepCopyObject method implementations that basically transforms the YAML to objects usable in Go.</p><p>After defining our API we can move to the controller package. There we should see the controller for the Kind generated by Operator SDK, called <code class="language-plaintext highlighter-rouge">samplekind_controller</code>. It has a reconcile function which is responsible for enforcing the desired state of the system based on the CR applied. So if we need certain changes applied based on the CR applied, we can write code for that in this section.</p><p>The logic is here is pretty simple for the reconciliation function.</p><ol><li>Confirm if resource needs to be created<li>If resource not found but should have existed, create it<li>If resource exists, confirm if it is the same as specified in CRD<li>If resource not found and it is not supposed to be created do nothing.</ol><p>Pretty simple logic. Remember this function will be called in cycles.</p><p>For our MockOperator, we will need a two k8s resources.</p><ol><li>A Deployment<li>Service to expose our deployment</ol><p>Putting this together we will have something like this in our reconcile function:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre><span class="c">// Fetch the SampleKind instance</span>
	<span class="n">sampleApp</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">appv1alpha1</span><span class="o">.</span><span class="n">SampleKind</span><span class="p">{}</span>
	<span class="n">err</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">NamespacedName</span><span class="p">,</span> <span class="n">sampleApp</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">errors</span><span class="o">.</span><span class="n">IsNotFound</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
			<span class="c">// Request object not found, could have been deleted after reconcile request.</span>
			<span class="c">// Owned objects are automatically garbage collected. For additional cleanup logic use finalizers.</span>
			<span class="c">// Return and don't requeue</span>
			<span class="n">log</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s">"SampleKind resource not found. Ignoring since object must be deleted"</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span> <span class="no">nil</span>
		<span class="p">}</span>
		<span class="c">// Error reading the object</span>
		<span class="k">return</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span> <span class="n">err</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s">"Detected existing SampleKind"</span><span class="p">,</span> <span class="s">" sampleApp.Name"</span><span class="p">,</span> <span class="n">sampleApp</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="c">// Check if the Deployment already exists, if not create a new one</span>
	<span class="n">deployment</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">appsv1</span><span class="o">.</span><span class="n">Deployment</span><span class="p">{}</span>
	<span class="n">deploymentName</span> <span class="o">:=</span> <span class="n">sampleApp</span><span class="o">.</span><span class="n">Name</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">NamespacedName</span><span class="p">{</span><span class="n">Name</span><span class="o">:</span> <span class="n">deploymentName</span><span class="p">,</span> <span class="n">Namespace</span><span class="o">:</span> <span class="n">sampleApp</span><span class="o">.</span><span class="n">Namespace</span><span class="p">},</span> <span class="n">deployment</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="o">&amp;&amp;</span> <span class="n">errors</span><span class="o">.</span><span class="n">IsNotFound</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="c">// Define a new configmap</span>
		<span class="n">deployment</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">newSampleAppDeployment</span><span class="p">(</span><span class="n">deploymentName</span><span class="p">,</span> <span class="n">sampleApp</span><span class="p">)</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s">"Creating a new SampleApp"</span><span class="p">,</span> <span class="s">"SampleKind.Namespace"</span><span class="p">,</span> <span class="n">sampleApp</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="s">"SampleKind.Name"</span><span class="p">,</span> <span class="n">sampleApp</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">deployment</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span> <span class="n">err</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{</span><span class="n">Requeue</span><span class="o">:</span> <span class="no">true</span><span class="p">},</span> <span class="no">nil</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span> <span class="n">err</span>
	<span class="p">}</span>

	<span class="n">service</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">corev1</span><span class="o">.</span><span class="n">Service</span><span class="p">{}</span>
	<span class="n">serviceName</span> <span class="o">:=</span> <span class="n">getServiceName</span><span class="p">(</span><span class="n">deploymentName</span><span class="p">)</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">NamespacedName</span><span class="p">{</span><span class="n">Name</span><span class="o">:</span> <span class="n">serviceName</span><span class="p">,</span> <span class="n">Namespace</span><span class="o">:</span> <span class="n">sampleApp</span><span class="o">.</span><span class="n">Namespace</span><span class="p">},</span> <span class="n">service</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="o">&amp;&amp;</span> <span class="n">errors</span><span class="o">.</span><span class="n">IsNotFound</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="c">// New service</span>
		<span class="n">service</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">newSampleAppService</span><span class="p">(</span><span class="n">deploymentName</span><span class="p">,</span> <span class="n">sampleApp</span><span class="p">)</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s">"Creating a new Service for SampleApp "</span><span class="p">,</span> <span class="s">"Service.Namespace"</span><span class="p">,</span> <span class="n">service</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="s">"Service.Name"</span><span class="p">,</span> <span class="n">service</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>

		<span class="n">err</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">service</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="c">//log failed to create</span>
			<span class="k">return</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span> <span class="n">err</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{</span><span class="n">Requeue</span><span class="o">:</span> <span class="no">true</span><span class="p">},</span> <span class="no">nil</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="c">//log failed to create</span>
		<span class="k">return</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span> <span class="n">err</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s">"Detected existing Service"</span><span class="p">,</span> <span class="s">" Service.Name"</span><span class="p">,</span> <span class="n">service</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
	<span class="p">}</span>
</pre></table></code></div></div><p>One other important thing, we need to make sure the MockOperator has access to create, update, delete and read these two k8s resources. so we add these three lines and with the help of kubebuidler, the next time we run <code class="language-plaintext highlighter-rouge">make generate manifests</code> the right permissions will be give to the operator.</p><div class="language-golang highlighter-rouge"><div class="code-header"> <span data-label-text="Golang"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c">//+kubebuilder:rbac:groups="apps",resources=deployments,verbs=get;list;watch;create;update;patch;delete</span>
<span class="c">//+kubebuilder:rbac:groups="",resources=pods,verbs=get;list;watch;create;update;delete;patch</span>
<span class="c">//+kubebuilder:rbac:groups="",resources=services,verbs=get;list;watch;create;update;patch;delete</span>
</pre></table></code></div></div><p>v. Sample Image for the Operator</p><p>Now this part is optional, but needed so we can test the kubernetes deployment the operator manages. It is a simple docker image packaging, called <code class="language-plaintext highlighter-rouge">sample-mock-service</code>, for a custom <em>HTML</em> page in nginx. This can be found in the <a href="https://github.com/malike/mock-operator/tree/main/sample-mock">folder</a>.</p><p>vi. Testing with Ginko and Gomega</p><p>Testing the Operator is specifically a large topic and it is not something I can fully expand on in this subsection. There are better resources like <a href="https://betterprogramming.pub/write-tests-for-your-kubernetes-operator-d3d6a9530840">this</a> and <a href="https://www.infracloud.io/blogs/testing-kubernetes-operator-envtest/">this</a>.</p><p>Our sample test will then look like this. It just uses BDD to confirm that when we create a <code class="language-plaintext highlighter-rouge">SampleKind</code>, a deployment also gets created.</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Describe</span><span class="p">(</span><span class="s">"Deployment test"</span><span class="p">,</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>

	<span class="k">const</span> <span class="p">(</span>
		<span class="n">name</span>      <span class="o">=</span> <span class="s">"deployment-test"</span>
		<span class="n">namespace</span> <span class="o">=</span> <span class="s">"default"</span>
	<span class="p">)</span>

	<span class="n">Context</span><span class="p">(</span><span class="s">"When SampleKind is created, Deployment is created"</span><span class="p">,</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>

		<span class="n">It</span><span class="p">(</span><span class="s">"allows deployment to be created and deleted"</span><span class="p">,</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>

			<span class="n">By</span><span class="p">(</span><span class="s">"set up deployment"</span><span class="p">,</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>

				<span class="n">skMockOperator</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">samplekind</span><span class="o">.</span><span class="n">SampleKind</span><span class="p">{</span>
					<span class="n">ObjectMeta</span><span class="o">:</span> <span class="n">metav1</span><span class="o">.</span><span class="n">ObjectMeta</span><span class="p">{</span>
						<span class="n">Name</span><span class="o">:</span>      <span class="n">name</span><span class="p">,</span>
						<span class="n">Namespace</span><span class="o">:</span> <span class="n">namespace</span><span class="p">,</span>
					<span class="p">},</span>
					<span class="n">Spec</span><span class="o">:</span> <span class="n">samplekind</span><span class="o">.</span><span class="n">SampleKindSpec</span><span class="p">{</span>
						<span class="n">Nodes</span><span class="o">:</span> <span class="m">1</span><span class="p">,</span>
					<span class="p">},</span>
				<span class="p">}</span>
				<span class="n">Expect</span><span class="p">(</span><span class="n">k8sClient</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">skMockOperator</span><span class="p">))</span><span class="o">.</span><span class="n">Should</span><span class="p">(</span><span class="n">Succeed</span><span class="p">())</span>

				<span class="n">EventuallyWithOffset</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="k">func</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
					<span class="n">smDeployment</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">v1</span><span class="o">.</span><span class="n">Deployment</span><span class="p">{}</span>
					<span class="n">err</span> <span class="o">:=</span> <span class="n">k8sClient</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">NamespacedName</span><span class="p">{</span><span class="n">Name</span><span class="o">:</span> <span class="n">skMockOperator</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">Namespace</span><span class="o">:</span> <span class="n">skMockOperator</span><span class="o">.</span><span class="n">Namespace</span><span class="p">},</span> <span class="n">smDeployment</span><span class="p">)</span>
					<span class="k">return</span> <span class="n">err</span> <span class="o">==</span> <span class="no">nil</span>
				<span class="p">})</span><span class="o">.</span><span class="n">WithTimeout</span><span class="p">(</span><span class="m">20</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span><span class="o">.</span><span class="n">Should</span><span class="p">(</span><span class="n">BeTrue</span><span class="p">())</span>

				<span class="c">//delete samplekind delete deployment</span>
				<span class="n">Expect</span><span class="p">(</span><span class="n">k8sClient</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">skMockOperator</span><span class="p">))</span><span class="o">.</span><span class="n">To</span><span class="p">(</span><span class="n">Succeed</span><span class="p">())</span>

			<span class="p">})</span>

		<span class="p">})</span>
	<span class="p">})</span>

<span class="p">})</span>
</pre></table></code></div></div><p>As you can see it is not extensive but since the MockOperator does little, the test coverage is pretty high as well.</p><p><img data-src="https://raw.githubusercontent.com/malike/malike-media/main/posts/operator-sdk/test-coverage.png" alt="test-coverage" data-proofer-ignore></p><p>vii. Automated Testings</p><p>Now we need to add a simple integration test to confirm our operator works as expected. Using <a href="https://github.com/helm/kind-action">https://github.com/helm/kind-action</a> we can set up a simple Kind cluster in K8s and then test the deployment of MockOperator and then using curl we can confirm if we can access the custom html page deployed in nginx.</p><p>A section of the Github Action pipeline looks like this:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Build and Test for Operator</span>

<span class="na">on</span><span class="pi">:</span> <span class="s">workflow_call</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Test</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Check out code</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v1</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create k8s Kind Cluster</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">helm/kind-action@v1.3.0</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to Github Packages</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/login-action@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">registry</span><span class="pi">:</span> <span class="s">ghcr.io</span>
          <span class="na">username</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">password</span><span class="pi">:</span> <span class="s">$</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Operator deployment</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">kubectl cluster-info</span>
          <span class="s">kubectl get pods -n kube-system</span>
          <span class="s">echo "current-context:" $(kubectl config current-context)</span>
          <span class="s">echo "environment-kubeconfig:" ${KUBECONFIG}</span>
          <span class="s">kubectl create ns mock-operator-system --save-config</span>
          <span class="s">kubectl create secret generic regcred --from-file=.dockerconfigjson=${HOME}/.docker/config.json --type=kubernetes.io/dockerconfigjson -n mock-operator-system</span>
          <span class="s">make deploy | grep created</span>
          <span class="s">kubectl rollout status deployment mock-operator-controller-manager -n mock-operator-system --timeout=30s</span>
          <span class="s">kubectl get crd | grep samplekind</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create deployment</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">kubectl create secret generic regcred --from-file=.dockerconfigjson=${HOME}/.docker/config.json --type=kubernetes.io/dockerconfigjson -n default</span>
          <span class="s">kubectl apply -f ci/sample.yaml | grep "lewis-sample"</span>
          <span class="s">sleep 5 ; kubectl get all</span>
          <span class="s">kubectl wait pods --selector app.kubernetes.io/instance=lewis-sample --for condition=Ready --timeout=40s | grep "condition met"</span>
          <span class="s">kubectl get po --show-labels | grep lewis-sample | grep "1/1"</span>
          <span class="s">kubectl port-forward svc/lewis-sample-service 8080:80 &amp;</span>
          <span class="s">sleep 5</span>
          <span class="s">curl localhost:8080 | grep mock</span>


      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Delete operator deployment</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">kubectl delete samplekind lewis-sample | grep deleted</span>
</pre></table></code></div></div><h1 id="conclusion">Conclusion</h1><p>Hopefully you found this useful and are able to kick-start your operator journey with this. The source code for this MockOperator can be found <a href="https://github.com/malike/mock-operator">here</a>.</p><h1 id="references">References</h1><p><a href="https://kubernetes.io/docs/concepts/extend-kubernetes/operator/">https://kubernetes.io/docs/concepts/extend-kubernetes/operator/</a></p><p><a href="https://kubebyexample.com/learning-paths">https://kubebyexample.com/learning-paths</a></p><p><a href="https://www.infracloud.io/blogs/testing-kubernetes-operator-envtest/">https://www.infracloud.io/blogs/testing-kubernetes-operator-envtest/</a></p><p><a href="https://betterprogramming.pub/write-tests-for-your-kubernetes-operator-d3d6a9530840">https://betterprogramming.pub/write-tests-for-your-kubernetes-operator-d3d6a9530840</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devops/'>devops</a>, <a href='/categories/sre/'>sre</a>, <a href='/categories/dev/'>dev</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/go/" class="post-tag no-text-decoration" >go</a> <a href="/tags/operatorsdk/" class="post-tag no-text-decoration" >operatorsdk</a> <a href="/tags/gke/" class="post-tag no-text-decoration" >gke</a> <a href="/tags/bdd/" class="post-tag no-text-decoration" >bdd</a> <a href="/tags/ginkgo/" class="post-tag no-text-decoration" >ginkgo</a> <a href="/tags/gomega/" class="post-tag no-text-decoration" >gomega</a> <a href="/tags/kubebuilder/" class="post-tag no-text-decoration" >kubebuilder</a> <a href="/tags/operator-sdk/" class="post-tag no-text-decoration" >operator-sdk</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Custom+Kubernetes+Operators+in+Golang+with+OperatorSDK+and+Kubebuilder+-+Malike+St&url=%2Fposts%2FCustom-Operator-With-Operator-SDK%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Custom+Kubernetes+Operators+in+Golang+with+OperatorSDK+and+Kubebuilder+-+Malike+St&u=%2Fposts%2FCustom-Operator-With-Operator-SDK%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2FCustom-Operator-With-Operator-SDK%2F&text=Custom+Kubernetes+Operators+in+Golang+with+OperatorSDK+and+Kubebuilder+-+Malike+St" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Predicting-Customer-Purchases-Beginners-Guide/">Predicting Customer Purchases: A Beginner's Guide to E-Commerce Data Science</a><li><a href="/posts/Obersevability-Stack-with-Grafana-Loki-And-Tempo/">Observability Stack with Grafana Loki Tempo and Prometheus</a><li><a href="/posts/Apache-Kafka-On-Kubernetes-Strimzi-Operator/">Apache Kafka on Kubernetes with Strimzi Operator</a><li><a href="/posts/Annotations+Spring=Awesome/">Java Annotations + Spring = Awesome</a><li><a href="/posts/Lambda-Architecture-RT/">Lambda Architecture With Kafka, ElasticSearch, Apache Storm and MongoDB</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/documentation/">documentation</a> <a class="post-tag" href="/tags/sample/">sample</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/distributed/">distributed</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/microservice/">microservice</a> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/To-Contain-Or-Not-To-Contain/"><div class="card-body"> <em class="small" data-ts="1536530400" data-df="ll" > Sep 10, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>To Contain Or Not To Contain</h3><div class="text-muted small"><p> So some of the known reasons why some people have talked to me about not adopting containers. So this my attempt to convince them based on the concerns raised and few use cases where I won’t sugges...</p></div></div></a></div><div class="card"> <a href="/posts/Build-Release-Dockerize-Run-With-Travis-CI/"><div class="card-body"> <em class="small" data-ts="1536616800" data-df="ll" > Sep 11, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Build, Release, Dockerize and Run with Github, Travis CI and DockerHub</h3><div class="text-muted small"><p> If you’ve read my previous post, Configuration Management for Microservices, I created two microservices one in Golang and the other in Java. Using the two, I’ll want to show how we can use Travis ...</p></div></div></a></div><div class="card"> <a href="/posts/Starting-With-Kubernetes-Docker-For-Mac-1/"><div class="card-body"> <em class="small" data-ts="1593122400" data-df="ll" > Jun 26, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Introduction to Software Development on Kubernetes - Part 1</h3><div class="text-muted small"><p> 1. Setting up Kubernetes Kubernetes is fast becoming, if not already, the OS for building cloud native applications. As someone put it, “the platform for building platforms”. As such people will w...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Obersevability-Stack-with-Grafana-Loki-And-Tempo/" class="btn btn-outline-primary" prompt="Older"><p>Observability Stack with Grafana Loki Tempo and Prometheus</p></a> <a href="/posts/Predicting-Customer-Purchases-Beginners-Guide/" class="btn btn-outline-primary" prompt="Newer"><p>Predicting Customer Purchases: A Beginner's Guide to E-Commerce Data Science</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/malike_st">Malike St</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/documentation/">documentation</a> <a class="post-tag" href="/tags/sample/">sample</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/distributed/">distributed</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/microservice/">microservice</a> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-66835539-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-66835539-1'); }); </script>
