<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Using Terraform on GCP, AWS and Physical Server" /><meta name="author" content="Malike St Lewis" /><meta property="og:locale" content="en" /><meta name="description" content="Terrafrom" /><meta property="og:description" content="Terrafrom" /><link rel="canonical" href="/posts/Using-Terraform-On-GCP-AWS-And-Physical-Server/" /><meta property="og:url" content="/posts/Using-Terraform-On-GCP-AWS-And-Physical-Server/" /><meta property="og:site_name" content="Malike St" /><meta property="og:image" content="https://raw.githubusercontent.com/malike/malike-media/main/posts/dilbert_system_admin.png" /><meta property="og:image:height" content="500" /><meta property="og:image:width" content="800" /><meta property="og:image:alt" content="automate." /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-05-11T00:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://raw.githubusercontent.com/malike/malike-media/main/posts/dilbert_system_admin.png" /><meta name="twitter:image:alt" content="automate." /><meta property="twitter:title" content="Using Terraform on GCP, AWS and Physical Server" /><meta name="twitter:site" content="@malike_st" /><meta name="twitter:creator" content="@malike_st" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Malike St Lewis","url":"https://github.com/malike/"},"dateModified":"2019-05-11T00:00:00+02:00","datePublished":"2019-05-11T00:00:00+02:00","description":"Terrafrom","headline":"Using Terraform on GCP, AWS and Physical Server","image":{"width":800,"height":500,"alt":"automate.","url":"/posts/dilbert_system_admin.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"/posts/Using-Terraform-On-GCP-AWS-And-Physical-Server/"},"url":"/posts/Using-Terraform-On-GCP-AWS-And-Physical-Server/"}</script><title>Using Terraform on GCP, AWS and Physical Server | Malike St</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Malike St"><meta name="application-name" content="Malike St"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.githubusercontent.com/malike/malike-media/main/common/avatar.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Malike St</a></div><div class="site-subtitle font-italic">Tech & stuff</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/sre/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>SRE</span> </a><li class="nav-item"> <a href="/distributed/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>DISTRIBUTED SYSTEMS</span> </a><li class="nav-item"> <a href="/electronics/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ELECTRONICS</span> </a><li class="nav-item"> <a href="/oss/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>OS PROJECTS I STARTED</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/malike" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://gitlab.com/malike" aria-label="gitlab" target="_blank" rel="noopener"> <i class="fab fa-gitlab"></i> </a> <a href="https://twitter.com/malike_st" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['st.malike','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Using Terraform on GCP, AWS and Physical Server</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Using Terraform on GCP, AWS and Physical Server</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1557525600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 11, 2019 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/malike/malike-media/main/posts/dilbert_system_admin.png" class="preview-img bg" alt="automate." width="800" height="500" data-proofer-ignore><figcaption class="pt-2 pb-2">automate.</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/malike/">Malike St Lewis</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1027 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><h3 id="terrafrom"><span class="mr-2"><a href="https://terraform.io/"><span class="mr-2">Terrafrom</a></span><a href="#terrafrom" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><em>“Terraform is an open-source infrastructure as code software tool created by HashiCorp. It enables users to define and provision a datacenter infrastructure using a high-level configuration language known as Hashicorp Configuration Language (HCL), or optionally JSON. Terraform supports a number of cloud infrastructure providers such as Amazon Web Services, IBM Cloud (formerly Bluemix), Google Cloud Platform, Linode, Microsoft Azure, Oracle Cloud Infrastructure, or VMware vSphere as well as OpenStack.”</em></p><p>For me that’s the one thing that sets Terraform apart from the others. It supports other cloud infra and doesn’t take a lot of effort to switch config from one to the other. Some people argue that to be cloud agnostic is a myth and just a marketing term, which may be partly true, but there many advantages to not tightly coupling everything in your infrastructure to one cloud service provider. For example AWS CloudFormation is cool but restricts you to just AWS. Terraform however supports many providers and allows you to provision resources on different servers and if abstracted properly you can use same terraform files to different cloud providers with minimal changes.</p><h3 id="terraform-101"><span class="mr-2">Terraform 101</span><a href="#terraform-101" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To help us appreciate this let’s create an nginx server on 3 types of servers, linux box, GCP and AWS. Before that a short Terraform 101 for more details you can read more <a href="https://www.terraform.io/docs/">here</a>.</p><p><em>1. Variables :</em> Input variables are used to define values that we can use to configure your infrastructure. There are different formats:</p><p><strong><em>i. string</em></strong></p><p>Strings mark a single value per structure and are commonly used to simplify and make complicated values more user-friendly. Below is an example of a string variable definition.</p><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">variable</span> <span class="s2">"username"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="s2">"malike_st"</span>
<span class="p">}</span>
</pre></table></code></div></div><p>and by using the template below we can substitute values for our variables in the <code class="language-plaintext highlighter-rouge">*.tf</code> files.</p><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">username</span> <span class="err">=</span> <span class="s2">"${var.username}"</span>
</pre></table></code></div></div><p><strong><em>ii. list</em></strong></p><p>List is a collection type that allows us to use multiple values for a variable and can easily be read by their indexes.</p><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">variable</span> <span class="s2">"servers"</span> <span class="p">{</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"server"</span><span class="p">,</span> <span class="s2">"server1"</span><span class="p">,</span> <span class="s2">"server2"</span><span class="p">]</span>
<span class="p">}</span>
</pre></table></code></div></div><p>and using indexes we can pick the value we want.</p><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">server</span> <span class="err">=</span> <span class="s2">"${var.servers[0]}"</span>
</pre></table></code></div></div><p><strong><em>iii. map</em></strong></p><p>Maps represent another type of collection defined by key value pairs.</p><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nx">variable</span> <span class="s2">"region_zone"</span> <span class="p">{</span>
    <span class="nx">type</span> <span class="p">=</span> <span class="s2">"map"</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
        <span class="s2">"us-central1"</span>  <span class="p">=</span> <span class="s2">"us-central1-b"</span>
        <span class="s2">"us-west2"</span> <span class="p">=</span> <span class="s2">"us-west2-a"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We can access any value by it matching key.</p><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">deployment_zone</span> <span class="err">=</span> <span class="s2">"${var.region_zone["</span><span class="nx">us</span><span class="err">-</span><span class="nx">central1</span><span class="s2">"]}"</span>
</pre></table></code></div></div><p><strong><em>iv. boolean</em></strong></p><p>The last type of variable types is boolean. Simple <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code> values we can use in our infrastructure set up</p><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">variable</span> <span class="s2">"set_password"</span> <span class="p">{</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="kc">false</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Variables can be set in a separate file, <code class="language-plaintext highlighter-rouge">tfvars</code> and used during deployment. This variable file will have passwords and other sensitive stuff we wouldn’t want to share with the world. It can be kept outside the terraform files so it’s not mistakenly versioned. By passing our variable file <code class="language-plaintext highlighter-rouge">terraform apply -var-file=../../aws_vars.tfvars</code> we can set the variables to use for a deployment.</p><p><em>2. Output Variables :</em> Output variables helps us get useful information about your infrastructure. For example to return the public ip of an EC2 instance after deployment. Since most of the computation is done during deployment, Output variables help us peek into the deployment as it happens.</p><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">output</span> <span class="s2">"aws_instance_public_dns"</span> <span class="p">{</span>
    <span class="nx">value</span> <span class="p">=</span> <span class="s2">"${aws_instance.nginx.public_dns}"</span>
<span class="p">}</span>
</pre></table></code></div></div><p><em>3. Providers :</em> A provider on Terraform provides an abstraction through which Terraform can work with the underlying resources of the IaaS (e.g. AWS, GCP, Microsoft Azure, Physical servers, Vagraant), PaaS (e.g. Heroku, CloudFoundry).</p><p>A list of providers supported by Terraform can be found <a href="https://www.terraform.io/docs/providers/">here</a> but that’s not an exhaustive list.</p><h6 id="an-aws-provider-"><center>An AWS provider </center></h6><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nx">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">access_key</span> <span class="p">=</span> <span class="s2">"${var.aws_access_key}"</span>
  <span class="nx">secret_key</span> <span class="p">=</span> <span class="s2">"${var.aws_secret_key}"</span>
  <span class="nx">region</span>     <span class="p">=</span> <span class="s2">"us-east-1"</span>
<span class="p">}</span>
</pre></table></code></div></div><h6 id="a-gcp-provider-"><center>A GCP provider </center></h6><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nx">provider</span> <span class="s2">"google"</span> <span class="p">{</span>
    <span class="nx">credentials</span> <span class="p">=</span> <span class="s2">"${file("</span><span class="nx">$</span><span class="p">{</span><span class="nx">var</span><span class="err">.</span><span class="nx">access_file</span><span class="p">}</span><span class="s2">")}"</span>
    <span class="nx">project</span>     <span class="p">=</span> <span class="s2">"${var.project_id}"</span>
    <span class="nx">region</span>      <span class="p">=</span> <span class="s2">"us-west2"</span>
<span class="p">}</span>
</pre></table></code></div></div><p><em>Resources :</em> A resource is basically any object under a provider (IaaS, PaaS) that we can can set up with a set of parameters. For example an EC2 instance is a type of resource on AWS and compute a resource on GCP.</p><h6 id="an-aws-resource-"><center>An AWS resource </center></h6><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nx">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"nginx1"</span> <span class="p">{</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="s2">"ami-c58c1dd3"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
  <span class="nx">subnet_id</span>     <span class="p">=</span> <span class="s2">"${aws_subnet.subnet1.id}"</span>
  <span class="nx">vpc_security_group_ids</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"${aws_security_group.nginx-sg.id}"</span><span class="p">]</span>
  <span class="nx">key_name</span>        <span class="p">=</span> <span class="s2">"${var.key_name}"</span>
<span class="p">}</span>
</pre></table></code></div></div><h6 id="a-gcp-resource-"><center>A GCP resource </center></h6><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nx">resource</span> <span class="s2">"google_compute_instance"</span> <span class="s2">"nginx"</span> <span class="p">{</span>
    <span class="nx">name</span>         <span class="p">=</span> <span class="s2">"nginx-vm-${random_id.instance_id.hex}"</span>
    <span class="nx">machine_type</span> <span class="p">=</span> <span class="s2">"f1-micro"</span>
    <span class="nx">zone</span>         <span class="p">=</span> <span class="s2">"us-west2-a"</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="simple-terraform-script-to-nginx-server"><span class="mr-2">Simple Terraform Script To NGINX server</span><a href="#simple-terraform-script-to-nginx-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Putting everything together <a href="https://github.com/malike/terraform-poc">here’s</a> a simple terraform set up to install NGINX server on local server, AWS and GCP with security groups/ firewall restrictions. You can see the similarities between all three scripts and the main difference being in the <strong><em>provider</em></strong> and <strong><em>resources</em></strong> because obviously you cant use AWS resources on GCP and vice-versa but because of terraform’s HCL it’s easier (imo) to use than the JSON or YAML.</p><p>For example this is the same resource declared in HCL (Terraform) and YML (CloudFormation)</p><h6 id="hcl--terrafrom-"><center>HCL : Terrafrom </center></h6><div class="language-hcl highlighter-rouge"><div class="code-header"> <span data-label-text="Hcl"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre> <span class="nx">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"nginx"</span> <span class="p">{</span>
    <span class="nx">ami</span>           <span class="p">=</span> <span class="s2">"ami-c58c1dd3"</span>
    <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
    <span class="nx">subnet_id</span>     <span class="p">=</span> <span class="s2">"${aws_subnet.subnet1.id}"</span>
 <span class="p">}</span>
</pre></table></code></div></div><h6 id="yml--cloudformation-"><center>YML : CloudFormation </center></h6><div class="language-yml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre> <span class="na">Resources</span><span class="pi">:</span>
   <span class="na">NGINXEC2Instance</span><span class="pi">:</span>
     <span class="na">Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AWS::EC2::Instance"</span>
     <span class="na">Properties</span><span class="pi">:</span>
        <span class="na">InstanceType</span><span class="pi">:</span> <span class="s2">"</span><span class="s">t2.micro"</span>
        <span class="na">ImageId</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ami-c58c1dd3"</span>
        <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!RefNginxSubnet1</span>
</pre></table></code></div></div><p>But why would one want to set up their environments on both AWS GCP or locally?, I don’t have all the answers but it’s quite easy to see different concerns by different teams for example one company will love to set up their environments locally and and not strictly restrict it to the cloud.</p><p>One other thing to like about Terraform is it keeps states in a file <code class="language-plaintext highlighter-rouge">terraform.tfstate</code>, where it keeps details about the terraform version and other meta data to improve performance of infrastructure and keep your infrastructure <em>sane</em>.</p><p>Terraform validates your configuration with <code class="language-plaintext highlighter-rouge">terraform plan</code>, where it will give you a summary of everything it will be doing before it actually does it with <code class="language-plaintext highlighter-rouge">terraform apply</code>.</p><p>Terraform is really cool and it’s opensource and I personally love it for being cloud agnostic and HCL, if you find it interesting as well and want to learn more <a href="https://learn.hashicorp.com/terraform/">https://learn.hashicorp.com/terraform/</a>.</p><p><br /> <br /> <strong>REFERENCES</strong></p><p><a href="https://www.terraform.io/docs/">https://www.terraform.io/docs/</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devops/'>devops</a>, <a href='/categories/sre/'>sre</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/terraform/" class="post-tag no-text-decoration" >terraform</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Using+Terraform+on+GCP%2C+AWS+and+Physical+Server+-+Malike+St&url=%2Fposts%2FUsing-Terraform-On-GCP-AWS-And-Physical-Server%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Using+Terraform+on+GCP%2C+AWS+and+Physical+Server+-+Malike+St&u=%2Fposts%2FUsing-Terraform-On-GCP-AWS-And-Physical-Server%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2FUsing-Terraform-On-GCP-AWS-And-Physical-Server%2F&text=Using+Terraform+on+GCP%2C+AWS+and+Physical+Server+-+Malike+St" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Predicting-Customer-Purchases-Beginners-Guide/">Predicting Customer Purchases: A Beginner's Guide to E-Commerce Data Science</a><li><a href="/posts/Obersevability-Stack-with-Grafana-Loki-And-Tempo/">Observability Stack with Grafana Loki Tempo and Prometheus</a><li><a href="/posts/Apache-Kafka-On-Kubernetes-Strimzi-Operator/">Apache Kafka on Kubernetes with Strimzi Operator</a><li><a href="/posts/Annotations+Spring=Awesome/">Java Annotations + Spring = Awesome</a><li><a href="/posts/Lambda-Architecture-RT/">Lambda Architecture With Kafka, ElasticSearch, Apache Storm and MongoDB</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/documentation/">documentation</a> <a class="post-tag" href="/tags/sample/">sample</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/distributed/">distributed</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/microservice/">microservice</a> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ChatOps-Slack-AWS-Integration/"><div class="card-body"> <em class="small" data-ts="1557612000" data-df="ll" > May 12, 2019 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ChatOps : Building A Custom Slackbot</h3><div class="text-muted small"><p> ChatOps “ChatOps is a new operational paradigm - work that is already happening in the background today is brought into a common chatroom. By doing this, you are unifying the communication about w...</p></div></div></a></div><div class="card"> <a href="/posts/Starting-With-Kubernetes-Docker-For-Mac-1/"><div class="card-body"> <em class="small" data-ts="1593122400" data-df="ll" > Jun 26, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Introduction to Software Development on Kubernetes - Part 1</h3><div class="text-muted small"><p> 1. Setting up Kubernetes Kubernetes is fast becoming, if not already, the OS for building cloud native applications. As someone put it, “the platform for building platforms”. As such people will w...</p></div></div></a></div><div class="card"> <a href="/posts/Kubernetes-Secrets-Store-CSI-Driver-PoC/"><div class="card-body"> <em class="small" data-ts="1642460400" data-df="ll" > Jan 18, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kubernetes Secrets Store CSI Driver POC</h3><div class="text-muted small"><p> Kubernetes Secrets Store CSI Driver POC Container Storage Interface is a standard for exposing arbitaryy block and file storage systems to containerized workloads in Kubernetes. There various thir...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/CI-CD-AWS-Infrastructure-For-Kubernetes-Cluster-Using-CloudFormation/" class="btn btn-outline-primary" prompt="Older"><p>Continuous Integration, continuous Deployment with AWS Using EKS, CodeBuild, CodePipeline, ECR and CloudFormation</p></a> <a href="/posts/ChatOps-Slack-AWS-Integration/" class="btn btn-outline-primary" prompt="Newer"><p>ChatOps : Building A Custom Slackbot</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/malike_st">Malike St</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/documentation/">documentation</a> <a class="post-tag" href="/tags/sample/">sample</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/distributed/">distributed</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/microservice/">microservice</a> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-66835539-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-66835539-1'); }); </script>
